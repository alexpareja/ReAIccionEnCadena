{% extends 'base_generic.html' %} 
{% load static %}

{% block title %} PARTIDA EN JUEGO {% endblock %} 

{% block content %}
</script>
<h1>PARTIDA EN JUEGO</h1>
<div id="game">
    <div id="panel">
        {% for palabra in palabras %}
        <li class="visible"><span class="palabraVisible">{{ palabra.p1 }}</span></li>
        <li class="invisible"><span class="palabraInvisible">{{ palabra.p2 }}</span></li>
        <li class="invisible"><span class="palabraInvisible">{{ palabra.p3 }}</span></li>
        <li class="visible"><span class="palabraVisible"></span>{{ palabra.p4 }}</span></li>
        <li class="invisible"><span class="palabraInvisible">{{ palabra.p5 }}</span></li>
        <li class="invisible"><span class="palabraInvisible">{{ palabra.p6 }}</span></li>
        <li class="visible"><span class="palabraVisible"></span>{{ palabra.p7 }}</span></li>
        {% endfor %}
    </div>
    
    <div id="jugadores">
        {% include 'base_players.html' %}
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const invisibles = document.querySelectorAll('#panel .invisible');
        let revealingElement = null; // Almacena el elemento que está siendo revelado

        invisibles.forEach(item => {
            item.dataset.revealedCount = 0;

            item.addEventListener('click', function() {
                // Comprueba si se está revelando otra palabra y si es el mismo elemento
                if (revealingElement && revealingElement !== this) return; // Ignora el clic si no es el elemento en revelación

                const maxReveal = this.textContent.length;
                let revealedCount = parseInt(this.dataset.revealedCount);

                if (revealedCount < maxReveal) {
                    revealingElement = this; // Establece el elemento actual como el elemento en revelación
                    const originalText = this.textContent;
                    revealedCount++;
                    this.dataset.revealedCount = revealedCount;

                    const visibleText = originalText.substr(0, revealedCount);
                    const hiddenText = originalText.substr(revealedCount);

                    this.innerHTML = `<span class="revealed-text">${visibleText}</span>` + '<span style="visibility:hidden;">' + hiddenText + '</span>';

                    if (!this.classList.contains('partially-revealed')) {
                        this.classList.add('partially-revealed');
                    }

                    // Restablece revealingElement para permitir nuevas revelaciones si se ha revelado completamente
                    if (revealedCount === maxReveal) {
                        revealingElement = null; // Permite comenzar a revelar otra palabra
                    }
                }
            });
        });
    });
</script>


<!-- 
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const invisibles = document.querySelectorAll('#panel .invisible');
    
        invisibles.forEach(item => {
            item.addEventListener('click', function() {
                // Solo actúa si el texto aún no ha sido revelado parcialmente.
                if (!this.classList.contains('partially-revealed')) {
                    const originalText = this.textContent;
                    // Aquí simplemente queremos mostrar la primera letra
                    // y mantener el resto como está, sin reemplazarlo con asteriscos.
                    this.innerHTML = `<span class="first-letter">${originalText[0]}</span>` + '<span style="visibility:hidden;">' + originalText.slice(1) + '</span>';
                    this.classList.add('partially-revealed'); // Marca el elemento como modificado.
                }
            });
        });
    });
</script>
-->
    
{% endblock %}
